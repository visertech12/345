import{f as t,bd as s,bP as e,bL as i,bu as a,q as l,v as r,t as u,w as o,B as h,F as d,C as p,D as n,x as c,bm as f,A as m,y as g,E as y,bp as _,G as b,H as x,u as C}from"./index-DJtkXLbk.js";import{_ as S}from"./fui-icon.Di2eQoC1.js";import{r as k}from"./uni-app.es.DnKBEGT2.js";import{_ as $}from"./_plugin-vue_export-helper.BCo6x5W8.js";const w=$({name:"fui-upload",emits:["success","error","complete","preview","reupload"],props:{width:{type:[Number,String],default:200},height:{type:[Number,String],default:200},fileList:{type:Array,default:()=>[]},max:{type:[Number,String],default:9},isAdd:{type:Boolean,default:!0},addColor:{type:String,default:"#333"},addSize:{type:[Number,String],default:88},background:{type:String,default:"#eee"},radius:{type:[Number,String],default:0},borderColor:{type:String,default:""},borderSytle:{type:String,default:"solid"},isDel:{type:Boolean,default:!0},delColor:{type:String,default:"rgba(0,0,0,.6)"},confirmDel:{type:Boolean,default:!1},url:{type:String,default:""},immediate:{type:Boolean,default:!1},callUpload:{type:Boolean,default:!1},sizeType:{type:Array,default:()=>["original","compressed"]},sourceType:{type:Array,default:()=>["album","camera"]},suffix:{type:Array,default:()=>[]},size:{type:[Number,String],default:4},name:{type:String,default:"file"},header:{type:Object,default:()=>({})},formData:{type:Object,default:()=>({})},param:{type:[Number,String],default:0}},data:()=>({urls:[],tempFiles:[],status:[]}),created(){this.initData(this.fileList)},watch:{fileList(t){this.initData(t)}},computed:{showAdd(){let t=!0,s=this.urls.length;return(!this.isAdd||-1==this.max&&s>=9||-1!=this.max&&s>=this.max)&&(t=!1),t}},methods:{initData(t){t=t||[],this.status=[];let s=[],e=[];t.forEach((t=>{s.push("success"),e.push({path:t})})),this.urls=[...t],this.tempFiles=e,this.status=s},reUpload(t){this.$set(this.status,t,"uploading"),this.callUpload?this.$emit("reupload",{index:t}):this.uploadImage(t,this.urls[t]).then((t=>{this._success(t)})).catch((t=>{this._error(t)}))},getStatus(){if(0===this.status.length)return"";let t="preupload";return-1===this.status.indexOf("preupload")&&(t=~this.status.indexOf("uploading")?"uploading":"success","uploading"!==t&&~this.status.indexOf("error")&&(t="error")),t},onComplete(t){let s=this.getStatus();this.$emit("complete",{status:s,urls:this.urls,action:t,param:this.param})},_success(t){let s=this.getStatus();this.$emit("success",{status:s,...t,param:this.param})},_error(t){let s=this.getStatus();this.$emit("error",{status:s,...t,param:this.param})},result(t,s){t&&void 0!==s&&(this.$set(this.urls,s,t),setTimeout((()=>{this.onComplete("upload")}),0))},toast(s){s&&t({title:s,icon:"none"})},chooseImage(){let t=Number(this.max);s({count:-1===t?9:t-this.urls.length,sizeType:this.sizeType,sourceType:this.sourceType,success:s=>{let e=[];for(let a=0;a<s.tempFiles.length;a++){if(this.urls.length>=t&&-1!==t){this.toast(`最多可上传${t}张图片`);break}let i=s.tempFiles[a].path;if(this.suffix.length>0){let t="";if(t=s.tempFiles[a].type.split("/")[1],-1==this.suffix.indexOf(t)){let t=`只能上传 ${this.suffix.join(",")} 格式图片！`;this.toast(t);continue}}let l=s.tempFiles[a].size;if(1024*Number(this.size)*1024<l){let t=`单张图片大小不能超过：${this.size}MB`;this.toast(t)}else e.push(i),this.urls.push(i),this.tempFiles.push(s.tempFiles[a]),this.status.push(this.immediate?"uploading":"preupload")}this.onComplete("choose");let i=this.urls.length-e.length;if(this.immediate)for(let t=0;t<e.length;t++){let s=i+t;this.uploadImage(s,e[t]).then((t=>{this._success(t)})).catch((t=>{this._error(t)}))}}})},uploadImage(t,s,i){return new Promise(((a,l)=>{e({url:this.url||i,name:this.name,header:this.header,formData:this.formData,filePath:s,success:s=>{200===s.statusCode?(this.$set(this.status,t,"success"),a({res:s,index:t})):(this.$set(this.status,t,"error"),l({res:s,index:t}))},fail:s=>{this.$set(this.status,t,"error"),l({res:s,index:t})}})}))},deleteImage(t){if("uploading"===this.getStatus())this.toast("请等待上传结束再进行删除！");else if(this.confirmDel){let s=this;i({content:"确定将该图片删除吗？",showCancel:!0,confirmText:"确定",success(e){e.confirm&&(s.urls.splice(t,1),s.tempFiles.splice(t,1),s.status.splice(t,1),s.onComplete("delete"))}})}else this.urls.splice(t,1),this.tempFiles.splice(t,1),this.status.splice(t,1),this.onComplete("delete")},previewImage(t){0!==this.status.length&&(a({current:this.urls[t],loop:!0,urls:this.urls}),this.$emit("preview",{index:t,urls:this.urls}))},start(){if(!this.url)return void this.toast("请传入服务器接口地址！");let t=[...this.urls];const s=t.length;for(let e=0;e<s;e++)t[e].startsWith("https")||(this.$set(this.status,e,"uploading"),this.uploadImage(e,t[e],this.url).then((t=>{this._success(t)})).catch((t=>{this._error(t)})))},upload(t,s){if(null==s){let s=[...this.urls];const e=s.length;for(let i=0;i<e;i++)s[i].startsWith("https")||(this.$set(this.status,i,"uploading"),"function"==typeof t&&t(this.tempFiles[i]).then((t=>{this.$set(this.status,i,"success"),this.result(t,i)})).catch((t=>{this.$set(this.status,i,"error")})))}else this.$set(this.status,s,"uploading"),"function"==typeof t&&t(this.tempFiles[s]).then((t=>{this.$set(this.status,s,"success"),this.result(t,s)})).catch((t=>{this.$set(this.status,s,"error")}))}}},[["render",function(t,s,e,i,a,$){const w=b,F=k(l("fui-icon"),S),z=x,D=C;return r(),u(D,{class:"fui-upload__wrap"},{default:o((()=>[(r(!0),h(d,null,p(a.urls,((t,s)=>(r(),u(D,{class:"fui-upload__item",style:n({width:e.width+"rpx",height:e.height+"rpx",borderRadius:e.radius+"rpx"}),key:s},{default:o((()=>[c(w,{class:"fui-upload__img",style:n({width:e.width+"rpx",height:e.height+"rpx",borderRadius:e.radius+"rpx"}),src:t,mode:"aspectFill",onClick:f((t=>$.previewImage(s)),["stop"])},null,8,["style","src","onClick"]),"success"!==a.status[s]&&"preupload"!==a.status[s]?(r(),u(D,{key:0,class:"fui-upload__mask"},{default:o((()=>["error"===a.status[s]?(r(),u(F,{key:0,name:"warning-fill",color:"#fff",size:48})):m("",!0),"error"===a.status[s]?(r(),u(z,{key:1,class:"fui-reupload__btn",onClick:f((t=>$.reUpload(s)),["stop"])},{default:o((()=>[g("重新上传")])),_:2},1032,["onClick"])):m("",!0),"uploading"===a.status[s]?(r(),u(D,{key:2,class:"fui-upload__loading",ref_for:!0,ref:"fui_reupload_ld"},null,512)):m("",!0),"uploading"===a.status[s]?(r(),u(z,{key:3,class:"fui-upload__text"},{default:o((()=>[g("请稍候...")])),_:1})):m("",!0)])),_:2},1024)):m("",!0),e.isDel?(r(),u(D,{key:1,class:"fui-upload__del",style:n({background:e.delColor}),onClick:f((t=>$.deleteImage(s)),["stop"])},{default:o((()=>[c(F,{name:"close",color:"#fff",size:32})])),_:2},1032,["style","onClick"])):m("",!0)])),_:2},1032,["style"])))),128)),$.showAdd?(r(),u(D,{key:0,class:y(["fui-upload__item",[e.borderColor&&!0!==e.borderColor?"fui-upload__border":"fui-upload__noborder"]]),style:n({width:e.width+"rpx",height:e.height+"rpx",background:e.background,borderRadius:e.radius+"rpx",borderColor:e.borderColor,borderStyle:e.borderSytle}),onClick:f($.chooseImage,["stop"])},{default:o((()=>[_(t.$slots,"default",{},(()=>[c(F,{name:"plus",size:e.addSize,color:e.addColor},null,8,["size","color"])]),!0)])),_:3},8,["class","style","onClick"])):m("",!0)])),_:3})}],["__scopeId","data-v-73bf7ee9"]]);export{w as _};
