import{a as e,b8 as o,b9 as t,f as s,bh as a,i as l,bi as c,e as r,bj as n,bk as i,q as d,t as u,w as p,u as g,v as h,x as f,y as m,z as _,H as b,bl as v,b5 as y}from"./index-DJtkXLbk.js";import{_ as $}from"./fui-icon.Di2eQoC1.js";import{r as k}from"./uni-app.es.DnKBEGT2.js";import{_ as x}from"./fui-nav-bar.jzMwm7nO.js";import{_ as C}from"./fui-button.Bz1nWTaC.js";import{_ as w}from"./uni-popup.CzvQehha.js";import{U as A}from"./uqrcode.Caz6u-nL.js";import{u as j}from"./user.Bg4aheva.js";import{_ as P}from"./_plugin-vue_export-helper.BCo6x5W8.js";const z=P({data(){return{onFocus:!1,verifyCode:"",secret:"",vcode:"",smscode:"",txt:this.$t("google.send")}},onShow(){},onReady(){this.getCode()},computed:{...e(["userAccount","googleCode","userTheme"])},methods:{submit(){if(this.vcode.length<6||this.smscode.length<6)return!1;this.$refs.confirmPop.close(),o({title:this.$t("secrety.processing")}),j.setGoogleSecret({sms_code:this.smscode,code:this.vcode,secret:this.secret,type:this.$util.isEmailAccount(this.userAccount)?1:2,account:this.userAccount}).then((e=>{t(),200!=e.code?s({title:e.message,icon:"none"}):(s({title:this.$t("google.google_bind_suc"),icon:"none"}),a.commit("updateInfo",{google2fa:this.secret}))}))},async sendSms(){if(o({title:this.$t("login.send")}),200!=(this.$util.isEmailAccount(this.userAccount)?await l.sendUnCodeEmail(this.userAccount):await l.sendUnCodePhone(this.userAccount)).code)return s({title:this.$t("secrety.fail_send"),icon:"none"}),!1;s({title:this.$t("secrety.suc_send"),icon:"none"}),this.initTime()},initTime(){var e=300,o=setInterval((()=>{this.txt=e+"s",--e<=1&&(clearInterval(o),this.txt=this.$t("authPop.resend"))}),1e3)},getCode(){o({title:"loading"}),j.getGoogleCode().then((e=>{if(t(),200!=e.code)return s({title:e.message,icon:"none"}),!1;this.secret=e.data.secret,this.createQrcode(e.data.secret)}))},createQrcode(e){var o=new A,t="otpauth://totp/"+this.userAccount+"?secret="+e;console.log(t),o.data=t,o.size=150,o.make();var s=c("qrcode",this);o.canvasContext=s,o.drawCanvas()},save(){this.$refs.confirmPop.open()},close(){this.$refs.confirmPop.close()},setCode(e){this.verifyCode=e.detail.value},copy(e){r({data:e,success(){s({title:this.$t("google.copy_suc"),icon:"none"})}})},saveQrcode(){n({canvasId:"qrcode",success(e){console.log(e),i({filePath:e.tempFilePath,success(){s({title:this.$t("google.save_suc"),icon:"none"})}})}})},downloadGoogle(){window.open("https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl=en_US&pli=1")}}},[["render",function(e,o,t,s,a,l){const c=k(d("fui-icon"),$),r=k(d("fui-nav-bar"),x),n=b,i=k(d("fui-button"),C),A=g,j=v,P=y,z=k(d("uni-popup"),w);return h(),u(A,{class:"googleAuth","data-theme":e.userTheme},{default:p((()=>[f(r,{statusBar:"",isFixed:"",isOccupy:"",zIndex:"9",background:"var(--background-primary)",color:"var(--content-primary)",title:e.googleCode?this.$t("google.page_title1"):this.$t("google.page_title"),onLeftClick:o[0]||(o[0]=o=>e.$mroute.back())},{default:p((()=>[f(c,{name:"arrowleft",size:"56",color:"var(--content-primary)"})])),_:1},8,["title"]),f(A,{class:"googleAuth-container"},{default:p((()=>[f(A,{class:"label"},{default:p((()=>[f(n,{class:"font-14 color-black font-weight"},{default:p((()=>[m(_(e.$t("google.install_t"))+" Google Authenticator ",1)])),_:1}),f(A,{class:"label-button"},{default:p((()=>[f(i,{height:"78rpx",background:"var(--content-primary)",color:"var(--background-primary)",size:"26",radius:"78rpx",text:e.$t("google.download_t"),onClick:o[1]||(o[1]=e=>l.downloadGoogle())},null,8,["text"])])),_:1})])),_:1}),f(A,{class:"label"},{default:p((()=>[f(n,{class:"font-14 color-black font-weight"},{default:p((()=>[m(_(e.$t("google.add_t"))+" Google Authenticator ",1)])),_:1}),f(n,{class:"description font-13 color-gray"},{default:p((()=>[m(_(e.$t("google.add_con")),1)])),_:1}),f(A,{class:"label-canvas"},{default:p((()=>[f(A,{class:"canvas-box"},{default:p((()=>[f(j,{id:"qrcode","canvas-id":"qrcode",style:{width:"150px",height:"150px",margin:"auto"}})])),_:1})])),_:1}),f(A,{class:"label-copy",onClick:o[2]||(o[2]=e=>l.copy(a.secret))},{default:p((()=>[f(n,{class:"font-14 font-weight color-black"},{default:p((()=>[m(_(a.secret),1)])),_:1})])),_:1}),f(A,{class:"label-button"},{default:p((()=>[f(i,{height:"78rpx",color:"var(--background-primary)",background:"var(--content-primary)",size:"26",radius:"78rpx",text:e.googleCode?this.$t("google.modify_bind"):this.$t("google.confirm_bind"),onClick:o[3]||(o[3]=e=>l.save())},null,8,["text"])])),_:1})])),_:1})])),_:1}),f(z,{ref:"confirmPop",type:"bottom"},{default:p((()=>[f(A,{class:"confirm-popup"},{default:p((()=>[f(A,{class:"confirm-popup-title"},{default:p((()=>[f(n,{class:"font-16 color-black font-weight"},{default:p((()=>[m(_(e.$t("authPop.safety_ver")),1)])),_:1}),f(A,{class:"close-icon",onClick:o[4]||(o[4]=e=>l.close())},{default:p((()=>[f(c,{name:"close",size:"48",color:"var(--content-primary)"})])),_:1})])),_:1}),f(A,{class:"confirm-popup-container"},{default:p((()=>[f(A,{class:"label-box"},{default:p((()=>[f(n,{class:"font-13 color-gray"},{default:p((()=>[m(_(e.$t("google.google_code")),1)])),_:1}),f(A,{class:"label-box-input"},{default:p((()=>[f(P,{type:"number",class:"font-14 color-black",modelValue:a.vcode,"onUpdate:modelValue":o[5]||(o[5]=e=>a.vcode=e),placeholder:e.$t("google.enter_google_code"),"placeholder-class":"placeholder"},null,8,["modelValue","placeholder"])])),_:1})])),_:1}),f(A,{class:"label-box"},{default:p((()=>[f(n,{class:"font-13 color-gray"},{default:p((()=>[m(_(e.$util.isEmailAccount(e.userAccount)?this.$t("secrety.email_code"):this.$t("secrety.phone_code")),1)])),_:1}),f(A,{class:"label-box-input",type:"phone"},{default:p((()=>[f(P,{type:"number",class:"font-14 color-black",modelValue:a.smscode,"onUpdate:modelValue":o[6]||(o[6]=e=>a.smscode=e),placeholder:this.$t("authPop.enter_code"),"placeholder-class":"placeholder"},null,8,["modelValue","placeholder"]),f(A,{class:"captcha"},{default:p((()=>[f(n,{onClick:l.sendSms,class:"font-13 color-primary"},{default:p((()=>[m(_(a.txt),1)])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1}),f(A,{class:"label-button"},{default:p((()=>[f(i,{height:"78rpx",background:a.smscode.length<6||a.vcode.length<6?"var(--background-secondary)":"var(--content-primary)",color:a.smscode.length<6||a.vcode.length<6?"var(--content-tertiary)":"var(--background-primary)",size:"26",radius:"78rpx",onClick:l.submit},{default:p((()=>[m(_(e.$t("hand.confirm_t")),1)])),_:1},8,["background","color","onClick"])])),_:1})])),_:1})])),_:1})])),_:1},512)])),_:1},8,["data-theme"])}],["__scopeId","data-v-4849f353"]]);export{z as default};
